<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FreshChain – Product History</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
body{font-family:Arial,sans-serif;padding:20px}
pre{background:#f5f5f5;padding:16px;border-radius:10px;white-space:pre-wrap}
</style>
</head>

<body>

<h2>FreshChain – Product History</h2>
<pre id="out">Loading...</pre>

<script>
const CONTRACT_ADDRESS="0xC7d8B75156Ac7fd509aD5eC360Bd0258A4459bfd";
const RPC="https://eth-sepolia.g.alchemy.com/v2/7nq9DSo1P4TvLc7p9bOfr";

const ABI=[
 "function getBatchHistory(uint256) view returns (uint256,string,uint256,address,address,address,address,bool,bool,(int256,int256,string,uint256,address)[],(address,address,uint256)[])"
];

const id=new URLSearchParams(window.location.search).get("batchId");
if(!id){out.innerText="❌ No batch ID provided";throw"";}

(async()=>{
  const provider=new ethers.providers.JsonRpcProvider(RPC);
  const c=new ethers.Contract(CONTRACT_ADDRESS,ABI,provider);
  const b=await c.getBatchHistory(id);

  let t=`Batch ID: ${b[0]}
Product: ${b[1]}
Quantity: ${b[2]}

Producer: ${b[3]}
Distributor: ${b[4]}
Retailer: ${b[5]}
Current Owner: ${b[6]}

Arrived: ${b[7]}
Inspection Passed: ${b[8]}\n`;

  b[9].forEach((s,i)=>{
    t+=`\nSensor ${i+1}: ${s[0]}°C, ${s[1]}%, ${s[2]}`;
  });

  out.innerText=t;
})();
</script>

</body>
</html>
