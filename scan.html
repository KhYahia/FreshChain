<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FreshChain ‚Äì Scan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
body { font-family: Arial; padding: 20px; text-align: center; }
.card {
  max-width: 420px;
  margin: auto;
  padding: 20px;
  border: 1px solid #ccc;
  border-radius: 12px;
}
pre {
  background: #f5f5f5;
  padding: 12px;
  border-radius: 8px;
  text-align: left;
}
</style>
</head>

<body>

<div class="card">
  <h2>FreshChain ‚Äì Product Info</h2>
  <pre id="out">Loading...</pre>
</div>

<script>
/* üîë ALCHEMY RPC (READ ONLY) */
const RPC =
  "https://eth-sepolia.g.alchemy.com/v2/7nq9DSo1P4TvLc7p9bOfr";

const CONTRACT =
  "0xC7d8B75156Ac7fd509aD5eC360Bd0258A4459bfd";

/* ABI: ONLY view function needed */
const ABI = [
 "function getBatchHistory(uint256) view returns (" +
 "uint256,string,uint256,address,address,address,address,bool,bool," +
 "(int256,int256,string,uint256,address)[]," +
 "(address,address,uint256)[])"
];

const id = new URLSearchParams(location.search).get("batchId");
if (!id) {
  out.innerText = "‚ùå No batchId provided";
  throw "";
}

(async () => {
  try {
    const provider = new ethers.providers.JsonRpcProvider(RPC);
    const contract = new ethers.Contract(CONTRACT, ABI, provider);

    const b = await contract.getBatchHistory(id);

    out.innerText = `
Batch ID: ${b[0]}
Product: ${b[1]}
Quantity: ${b[2]}

Producer: ${b[3]}
Distributor: ${b[4]}
Retailer: ${b[5]}
Current Owner: ${b[6]}

Arrived: ${b[7]}
Inspection Passed: ${b[8]}
    `;
  } catch (e) {
    out.innerText = "‚ùå Error: " + (e.reason || e.message);
  }
})();
</script>

</body>
</html>
